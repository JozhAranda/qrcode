<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">    
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/snackbar.min.css" rel="stylesheet" />
    <link href="assets/css/home.css" rel="stylesheet" />
    <link href="assets/css/mobile.css" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body onload="init()">

    <div class="row" style="margin-left: 0;margin-right: 0;">
      <div class="col-xs-12 headerLogo"style="margin: 30px 0 40px 0;">
        <div class="col-xs-6">
          <img src="assets/img/sspm_logo.png" class="img img-responsive headerImg" alt="logo" />
        </div>
        <div class="col-xs-6">
          <p class="headerText">
            Aplicación de Verificación
            <span style="color: rgba(0, 23, 52, 0.8);font-weight: 600;"> Infracciones de Transito</span>
          </p>
        </div>
      </div>      
      <div class="container">
        <div class="col-xs-4 col-xs-offset-4" style="margin-top: 40px;">
          <button class="btn btn-info btn-block" id="scan">Scan</button>
          <br/><br/>
          <a target="_blank" class="btn btn-success btn-block" href="#display">Display Scanned Data</a>
        </div>
        <div class="col-xs-8 col-xs-offset-2" style="margin-top: 40px;">
          <div class="table-responsive">
            <table class="table table-hover table-border" id="allTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.mobile.min.js"></script>
    <script src="cordova.js" type="text/javascript"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/snackbar.min.js"></script>
    
    <script type="text/javascript" charset="utf-8">
      document.addEventListener("deviceready", onDeviceReady, false);

      function onDeviceReady() {

        $('#scan').on('click touch', function (){
          cordova.plugins.barcodeScanner.scan(
            function (result) {
              if(!result.cancelled) {
                if(result.format == "QR_CODE") {
                  navigator.notification.prompt("Please enter name of data", function(input) {
                    var name = input.input1;
                    var value = result.text;

                    var data = localStorage.getItem("LocalData");
                    alert(data);
                    data = JSON.parse(data);
                    data[data.length] = [name, value];

                    localStorage.setItem("LocalData", JSON.stringify(data));

                    alert("Done");
                  });
                }
              }
            },
            function (error) {
              alert("Scanning failed: " + error);
            }
          );
        });

        $(document).on("pagebeforeshow", "#display", function() {
          $("table#allTable tbody").empty();

          var data = localStorage.getItem("LocalData");
          data = JSON.parse(data);

          var html = "";

          for(var count = 0; count < data.length; count++) {
            html = html + "<tr><td>" + data[count][0] + "</td><td><a href='javascript:openURL(\"" + data[count][1] + "\")'>" + data[count][1] + "</a></td></tr>";
          }

          $("table#allTable tbody").append(html).closest("table#allTable").table("refresh").trigger("create");
        });

        function openURL(url) {
          window.open(url, '_blank', 'location=yes');
        }

      }
    </script>
  </body>
</html> 